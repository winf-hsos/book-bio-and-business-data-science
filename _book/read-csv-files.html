<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-0.9.563">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Bio and Business Data Science - 1&nbsp; CSV-Dateien einlesen</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./explore-new-data-sets.html" rel="next">
<link href="./case-campusbier.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "Suchtreffer",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }"><div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">
<span class="chapter-number">1</span>&nbsp; <span class="chapter-title">CSV-Dateien einlesen</span>
</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Bio and Business Data Science</a> 
        <div class="sidebar-tools-main">
    <a href="" title="Share" id="sidebar-tool-dropdown-0" class="sidebar-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi bi-share"></i></a>
    <ul class="dropdown-menu" aria-labelledby="sidebar-tool-dropdown-0">
<li>
          <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=%7Curl%7C">
            <i class="bi bi-bi-twitter pe-1"></i>
          Twitter
          </a>
        </li>
        <li>
          <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=%7Curl%7C">
            <i class="bi bi-bi-facebook pe-1"></i>
          Facebook
          </a>
        </li>
        <li>
          <a class="dropdown-item sidebar-tools-main-item" href="https://www.linkedin.com/sharing/share-offsite/?url=%7Curl%7C">
            <i class="bi bi-bi-linkedin pe-1"></i>
          LinkedIn
          </a>
        </li>
    </ul>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Vorwort</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
    <div class="sidebar-item-container"> 
        <a href="./case-campusbier.html" class="sidebar-item-text sidebar-link">Fall: Campusbier</a>
      <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
        <i class="bi bi-chevron-right ms-2"></i>
      </a>
    </div>
    <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./read-csv-files.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">CSV-Dateien einlesen</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./explore-new-data-sets.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Datensätze erkunden</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./select-columns.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Spalten auswählen</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./add-and-modify-columns.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Spalten hinzufügen und verändern</span></a>
  </div>
</li>
    </ul>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">Quellen</a>
  </div>
</li>
    </ul>
</div>
</nav><!-- margin-sidebar --><div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc"><h2 id="toc-title">Inhalt</h2>
   
  <ul>
<li>
<a href="#das-csv-format" id="toc-das-csv-format" class="nav-link active" data-scroll-target="#das-csv-format"> <span class="header-section-number">1.1</span> Das CSV-Format</a>
  <ul class="collapse">
<li><a href="#csv-als-weit-verbreitetes-format" id="toc-csv-als-weit-verbreitetes-format" class="nav-link" data-scroll-target="#csv-als-weit-verbreitetes-format">CSV als weit verbreitetes Format</a></li>
  <li><a href="#csv-eignet-sich-f%C3%BCr-strukturierte-daten" id="toc-csv-eignet-sich-für-strukturierte-daten" class="nav-link" data-scroll-target="#csv-eignet-sich-f%C3%BCr-strukturierte-daten">CSV eignet sich für strukturierte Daten</a></li>
  <li><a href="#beispiel-einer-csv-datei" id="toc-beispiel-einer-csv-datei" class="nav-link" data-scroll-target="#beispiel-einer-csv-datei">Beispiel einer CSV-Datei</a></li>
  </ul>
</li>
  <li>
<a href="#csv-daten-laden-mit-readr" id="toc-csv-daten-laden-mit-readr" class="nav-link" data-scroll-target="#csv-daten-laden-mit-readr"> <span class="header-section-number">1.2</span> CSV-Daten laden mit <code>{readr}</code></a>
  <ul class="collapse">
<li><a href="#aus-einer-lokalen-datei" id="toc-aus-einer-lokalen-datei" class="nav-link" data-scroll-target="#aus-einer-lokalen-datei">Aus einer lokalen Datei</a></li>
  <li><a href="#nur-bestimmte-spalten-laden" id="toc-nur-bestimmte-spalten-laden" class="nav-link" data-scroll-target="#nur-bestimmte-spalten-laden">Nur bestimmte Spalten laden</a></li>
  <li><a href="#das-dezimaltrennzeichen-bestimmen" id="toc-das-dezimaltrennzeichen-bestimmen" class="nav-link" data-scroll-target="#das-dezimaltrennzeichen-bestimmen">Das Dezimaltrennzeichen bestimmen</a></li>
  <li><a href="#datentypen-beim-laden-setzen" id="toc-datentypen-beim-laden-setzen" class="nav-link" data-scroll-target="#datentypen-beim-laden-setzen">Datentypen beim Laden setzen</a></li>
  <li><a href="#daten-von-einem-webserver-laden" id="toc-daten-von-einem-webserver-laden" class="nav-link" data-scroll-target="#daten-von-einem-webserver-laden">Daten von einem Webserver laden</a></li>
  </ul>
</li>
  <li><a href="#%C3%BCbungsaufgaben" id="toc-übungsaufgaben" class="nav-link" data-scroll-target="#%C3%BCbungsaufgaben">Übungsaufgaben</a></li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title d-none d-lg-block">
<span class="chapter-number">1</span>&nbsp; <span class="chapter-title">CSV-Dateien einlesen</span>
</h1>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header><div class="cell">

</div>
<p>Im ersten Schritt jeder Datenanalyse müssen wir unserem Computer den Datensatz zur Verfügung stellen. Wir sprechen dabei auch vom <em>Laden</em> des Datesatzes. Dabei sagen wir dem Computer, wo die Daten zu finden sind, und dass er sie für den schnelleren Zugriff in seinen Arbeitsspeicher holen soll.</p>
<p>Daten liegen in den meisten Fällen in Form von Dateien vor. In manchen Fällen sind sie auch in einer Datenbank gespeichert. Im Fall einer Datei kann ein Datensatz in unterschiedlichen <em>Formaten</em> darin gespeichert werden. Ein gängiges Format ist das CSV-Format, das auf einfachen Textdateien basiert.</p>
<section id="das-csv-format" class="level2" data-number="1.1"><h2 data-number="1.1" class="anchored" data-anchor-id="das-csv-format">
<span class="header-section-number">1.1</span> Das CSV-Format</h2>
<section id="csv-als-weit-verbreitetes-format" class="level3"><h3 class="anchored" data-anchor-id="csv-als-weit-verbreitetes-format">CSV als weit verbreitetes Format</h3>
<p>Textdateien bieten sich für die Speicherung von Daten an, weil sie auf jedem Betriebsystem mit einem einfachen Texteditor betrachtet und bearbeitet werden können. Das ermöglicht das schnelle Teilen von Daten und somit die Zusammenarbeit. Auch für den Datenaustausch zwischen verschiedenen Informationssystemen wird häufig ein textbasiertes Format verwendet, um spezifisches Formate der jeweiligen Hersteller, wie etwa proprieäte Datenbanken, zu überbrücken. Deshalb bieten die meisten Informationssysteme Schnittstellen für den Export und Import von Textdateien an. Speziell das CSV-Format ist hier sehr beliebt, aus guten Gründen:</p>
<ul>
<li>Die Verwendung von einfachen Textdateien erlaubt die Speicherung und Verarbeitung auf unterschiedlichen Umgebungen wie Windows, macOS oder Linux.</li>
<li>Das Format ist einfach zu verstehen und auch für Menschen lesbar.</li>
<li>CSV ist ein offenes Format, d.&nbsp;h. es gibt keine Organisation, die daran die Rechte besitzt und es kann daher von jeder Software verwendet werden. Es gab lange nicht einmal eine offizielle Spezifikation des Formats. Mittlerweile gibt es eine Spezifikation als offizieller <a href="https://tools.ietf.org/html/rfc4180">MIME Type</a>.</li>
</ul>
<p>Auch das E-Commerce-System Shopify, aus dem die vorligenden Verkaufsdaten stammen, bietet eine Möglichkeit zum Exportieren von Textdateien im sogenannten CSV-Format an.</p>
</section><section id="csv-eignet-sich-für-strukturierte-daten" class="level3"><h3 class="anchored" data-anchor-id="csv-eignet-sich-für-strukturierte-daten">CSV eignet sich für strukturierte Daten</h3>
<p>CSV steht für <em>Comma Separated Values</em> und beschreibt ein Format, um <em>strukturierte Daten</em> in einer Textdatei abzuspeichern. Ihr erkennt eine Textdatei im CSV-Format an der Endung <code>.csv</code>.</p>
<p>Das CSV-Format basiert auf einfachen Textkodierungen, häufig im UTF-8 oder ASCII-Kodierungssystem (letzeres immer seltener wegen der geringen Anzahl verfügbarer Zeichen), die mit fast jedem Werkzeug und Editor gelesen und bearbeitet werden können. Das CSV-Format speichert strukturierte Daten in einer tabellarischen Form, ähnlich wie in Spreadsheets. Die erste Zeile einer CSV-Datei ist üblicherweise der sogenannte Header (Kopfzeile) und beinhaltet die Spaltennamen mit Komma oder Semikolon (Trennzeichen) voneinander getrennt. Jede weitere Zeile stellt eine Beobachtung (Englisch: <em>observation</em> oder <em>case</em>) oder auch Datensatz (Englisch: <em>record</em>) dar. Jeder Datensatz enthält für die im Header definierten Attribute (oder Spalten) die beobachteten Werte, die durch das gleiche Trennzeichen voneinander getrennt sind. Es muss nicht jeder Spaltenwert existieren. Sollte ein Wert für eine Beobachtung nicht vorhanden sein, so wird nach dem Komma nichts eingetragen und es folgen zwei Kommata nacheinander. In R werden fehlende Werte beim Einlesen erkannt und mit <code>NA</code> gekennzeichnet.</p>
<p>Die Verwendung des Komma als Trennzeichen in CSV-Dateien ist keineswegs verbindlich, auch wenn es Bestandteil des Namens ist. Generell kann jedes Symbol verwendet werden. Häufige Alternativen sind das Semikolon, Leerzeichen oder ein Tabstop. Letzteres wird oft mit der eigenen Endung <code>.tsv</code> für <em>Tab Separated Values</em> gespeichert.</p>
</section><section id="beispiel-einer-csv-datei" class="level3"><h3 class="anchored" data-anchor-id="beispiel-einer-csv-datei">Beispiel einer CSV-Datei</h3>
<p>Der Auschnitt unten zeigt die ersten vier Zeilen der <code>orders.csv</code>. Die erste Zeile enthält die Namen der hier gezeigten vier Spalten (der Datensatz hat mehr Spalten, das ist nur ein Auszug), die mit einem Komma voneinander getrennt sind. Darunter folgen drei beispielhafte Datensätze:</p>
<pre><code>id,order_id,name,order_number,app_id,created_at
1130007101519,B1014,1014,580111,2019-05-24T14:59:16+02:00
1130014965839,B1015,1015,580111,2019-05-24T15:09:08+02:00
1130026958927,B1016,1016,580111,2019-05-24T15:22:41+02:00
...</code></pre>
</section></section><section id="csv-daten-laden-mit-readr" class="level2" data-number="1.2"><h2 data-number="1.2" class="anchored" data-anchor-id="csv-daten-laden-mit-readr">
<span class="header-section-number">1.2</span> CSV-Daten laden mit <code>{readr}</code>
</h2>
<section id="aus-einer-lokalen-datei" class="level3"><h3 class="anchored" data-anchor-id="aus-einer-lokalen-datei">Aus einer lokalen Datei</h3>
<p>Für das Laden von Datensätzen aus CSV-Dateien bietet das Tidyverse ein Paket namens <a href="https://readr.tidyverse.org">readr</a> an. Dieses wird automatisch mit dem <a href="https://tidyverse.tidyverse.org">tidyverse</a>-Paket mitgeladen. Das Paket bietet für CSV-Dateien, bei denen das Komma als Trennzeichen verwendet wird, die Funktion <code>read_csv()</code> an:</p>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">orders</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span><span class="st">"./data/orders.csv"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout-tip callout callout-style-simple">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>In einigen Ländern Europas wird häufig ein Semikolon als Trennzeichen und ein Komma als Dezimaltrennzeichen verwendet (wie etwa in Deutschland). Für diesen Fall bietet <a href="https://readr.tidyverse.org">readr</a> die Funktion <code>read_csv2</code>. Um es selbst in der Hand zu haben, kann die Funktion <code>read_delim</code> verwendet werden und über den Parameter <code>delim</code> das Trennzeichen manuell eingestellt werden.</p>
</div>
</div>
</div>
<p>Auch der R-Basisumfang bietet eine ähnliche Funktion für genau diesen Anwendungsfall an. Diese heisst <code><a href="https://rdrr.io/r/utils/read.table.html">read.csv()</a></code>, man achte hier auf das Detail: Statt eines Unterstrichs <code>_</code> wird bei der R-Basisfunktion ein Punkt <code>.</code> zwischen den beiden Wörtern <code>read</code> und <code>csv</code> verwendet. Wenn ihr mit dem Tidyverse und mit Tibbles arbeitet (wie in diesem Buch durchgängig), dann achtet darauf, stets die <a href="https://readr.tidyverse.org">readr</a>-Funktion <code>read_csv()</code> zu verwenden, weil nur diese die Daten als Tibble zurückgibt und zudem einige paar nützliche Zusatzfunktionen bietet.</p>
</section><section id="nur-bestimmte-spalten-laden" class="level3"><h3 class="anchored" data-anchor-id="nur-bestimmte-spalten-laden">Nur bestimmte Spalten laden</h3>
<p>Die <code>read_csv()</code>-Funktion erlaubt direkt beim Laden der Daten eine Auswahl der Spalten vorzunehmen. Ich empfehle hier immer die Verwendung der <code>select</code>-Funktion, die wir im nächsten Abschnitt kennenlernen werden. Dennoch möchte ich kurz demonstrieren, wie das Filtern der Spalten direkt beim Laden funktioniert.</p>
<p>Der folgende Code lädt die Spalten <code>order_id</code>, <code>name</code>, sowie alle Spalten, deren Name mit “customer” beginnen:</p>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">orders</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span><span class="st">"./data/orders.csv"</span>, col_select <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">order_id</span>, <span class="va">name</span>, <span class="fu">starts_with</span><span class="op">(</span><span class="st">"customer"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Im Ergebnis ist der resultierende Tibble dann sehr viel schmaler und beinhaltet nur die gewünschten Spalten:</p>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">orders</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "order_id"                             
 [2] "name"                                 
 [3] "customer_id"                          
 [4] "customer_accepts_marketing"           
 [5] "customer_accepts_marketing_updated_at"
 [6] "customer_marketing_opt_in_level"      
 [7] "customer_sms_marketing_consent"       
 [8] "customer_created_at"                  
 [9] "customer_updated_at"                  
[10] "customer_gender"                      
[11] "customer_is_hsos"                     
[12] "customer_state"                       
[13] "customer_orders_count"                
[14] "customer_total_spent"                 
[15] "customer_last_order_id"               
[16] "customer_note"                        
[17] "customer_verified_email"              
[18] "customer_tax_exempt"                  
[19] "customer_tags"                        
[20] "customer_last_order_name"             </code></pre>
</div>
</div>
<p>Hat man nur eine Filterbedingung, so kann man sich die <code><a href="https://rdrr.io/r/base/c.html">c()</a></code>-Funktion auch sparen:</p>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">orders</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span><span class="st">"./data/orders.csv"</span>, col_select <span class="op">=</span> <span class="fu">starts_with</span><span class="op">(</span><span class="st">"shipping"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Das Ergebnis:</p>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">orders</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "shipping_address_city"      "shipping_address_zip"      
[3] "shipping_address_country"   "shipping_address_latitude" 
[5] "shipping_address_longitude"</code></pre>
</div>
</div>
<p>Ist man auf möglichst wenige Zeilen Code aus, so kann die Verwendung des <code>col_types</code>-Parameters durchaus Sinn ergeben. Man könnte den gleichen Effekt auch mit einem anschließenden <code>select</code> erzielen:</p>
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">orders</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span><span class="st">"./data/orders.csv"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="fu">starts_with</span><span class="op">(</span><span class="st">"shipping"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Mehr zur Auswahl von Spalten mit <a href="https://dplyr.tidyverse.org">dplyr</a> erfahrt ihr in <a href="select-columns.html"><span>Kapitel&nbsp;3</span></a>.</p>
</section><section id="das-dezimaltrennzeichen-bestimmen" class="level3"><h3 class="anchored" data-anchor-id="das-dezimaltrennzeichen-bestimmen">Das Dezimaltrennzeichen bestimmen</h3>
<p>Wollen wir nur das Dezimaltrennzeichen ändern, weil wir zum Beispiel Daten aus einem deutschen System exportiert haben, das ein Komma verwendet, so können wir das über den <code>locale</code>-Parameter erreichen. Im Beispiel unten verwenden wir zusätzlich das Pipe-Symbol | als Trennzeichen. Beides können wir über <code>read_delim</code> einstellen:</p>
<div class="cell">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Daten in sales.csv</span></span>
<span><span class="co"># year,month,turnover</span></span>
<span><span class="co"># 2022|01|2700,85</span></span>
<span><span class="co"># 2022|02|2910,10</span></span>
<span><span class="co"># 2022|03|1802,37</span></span>
<span></span>
<span><span class="va">turnover</span> <span class="op">&lt;-</span> <span class="fu">read_delim</span><span class="op">(</span><span class="st">"sales.csv"</span>, </span>
<span>                       delim <span class="op">=</span> <span class="st">"|"</span>, </span>
<span>                       locale <span class="op">=</span> <span class="fu">locale</span><span class="op">(</span>decimal_mark <span class="op">=</span> <span class="st">","</span><span class="op">)</span></span>
<span>                       <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Das Ergebnis:</p>
<div class="cell">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">turnover</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 x 3
   year month turnover
  &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt;
1  2022 01       2701.
2  2022 02       2910.
3  2022 03       1802.</code></pre>
</div>
</div>
</section><section id="datentypen-beim-laden-setzen" class="level3"><h3 class="anchored" data-anchor-id="datentypen-beim-laden-setzen">Datentypen beim Laden setzen</h3>
<p>Beim Laden mit <code>read_csv</code> wird möglicherweise der Datentyp einiger Spalten falsch erkannt. DIe Funktion betrachtet die ersten Zeilen und ermittelt darauf basierend den Datentyp. Wird dieser falsch erkannt, so können wir den Datentyp für Spalten explizit angeben. Wie auch das Auswählen von Spalten können wir den Datentyp schon beim Laden mitgeben. Alternativ können wir den Datentyp auch später mit <code>mutate</code> noch verändern.</p>
<div class="callout-tip callout callout-style-simple">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>Manchmal hilft es schon, den Parameter <code>guess_max</code> auf einen größeren Wert zu setzen. Dieser bestimmt, wie viele Werte die Funktion betrachtet, um daraus den Datentyp einer Spalte abzuleiten. Standardmäßig ist dieser Wert auf 1000 begrenzt.</p>
</div>
</div>
</div>
<p>In unserem Datensatz <code>orders.csv</code> sind tatsächlich einige Datentypen falsch erkannt worden. Etwa die Spalte <code>order_id</code>, die als Datentyp <code>double</code> erkannt wird. Auch wenn die Werte allesamt als Dezimalzahlen betrachtet werden können, handelt es sich bei einer Bestellnummer nicht um eine Zahl in dem Sinne, dass man damit rechnen möchte. Es ist vielmehr eine Zeichenfolge, die per Konvention nur aus Zahlen besteht (aber nicht müsste). Der Datentyp <code>character</code> wäre somit angebrachter. Das können wir wie folgt ändern:</p>
<div class="cell">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">orders</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span><span class="st">"./data/orders.csv"</span>,</span>
<span>                   col_types <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"order_id"</span> <span class="op">=</span> <span class="fu">col_character</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Die Spalte order_id ist jetzt vom Typ &lt;chr&gt;</span></span>
<span><span class="va">orders</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">order_id</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2,874 x 1
   order_id     
   &lt;chr&gt;        
 1 1130007101519
 2 1130014965839
 3 1130026958927
 4 1130030563407
 5 1130038853711
 6 1130045964367
 7 1130050519119
 8 1130060283983
 9 1130102194255
10 1130106880079
# ... with 2,864 more rows</code></pre>
</div>
</div>
<p>Das Gleiche können wir mit beliebig vielen Spalten gleichzeitig durchführen. Denn auch die beiden Spalten mit Postleitzahlen wurden fälschlicherweise als <code>double</code> erkannt:</p>
<div class="cell">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">orders</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span><span class="st">"./data/orders.csv"</span>,</span>
<span>                   col_types <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>                     <span class="st">"order_id"</span> <span class="op">=</span> <span class="fu">col_character</span><span class="op">(</span><span class="op">)</span>,</span>
<span>                     <span class="st">"app_id"</span> <span class="op">=</span> <span class="fu">col_character</span><span class="op">(</span><span class="op">)</span>,</span>
<span>                     <span class="st">"billing_address_zip"</span><span class="op">=</span> <span class="fu">col_character</span><span class="op">(</span><span class="op">)</span>,</span>
<span>                     <span class="st">"shipping_address_zip"</span><span class="op">=</span> <span class="fu">col_character</span><span class="op">(</span><span class="op">)</span></span>
<span>                     <span class="op">)</span></span>
<span>                   <span class="op">)</span></span>
<span></span>
<span><span class="co"># Die Spalte order_id ist jetzt vom Typ &lt;chr&gt;</span></span>
<span><span class="va">orders</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">order_id</span>, <span class="va">app_id</span>, <span class="va">billing_address_zip</span>, <span class="va">shipping_address_zip</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2,874 x 4
   order_id      app_id billing_address_zip shipping_address_zip
   &lt;chr&gt;         &lt;chr&gt;  &lt;chr&gt;               &lt;chr&gt;               
 1 1130007101519 580111 49610               &lt;NA&gt;                
 2 1130014965839 580111 49088               49088               
 3 1130026958927 580111 49080               &lt;NA&gt;                
 4 1130030563407 580111 45888               &lt;NA&gt;                
 5 1130038853711 580111 49356               &lt;NA&gt;                
 6 1130045964367 580111 49477               &lt;NA&gt;                
 7 1130050519119 580111 49090               49090               
 8 1130060283983 580111 48356               48356               
 9 1130102194255 580111 49090               49090               
10 1130106880079 580111 49090               &lt;NA&gt;                
# ... with 2,864 more rows</code></pre>
</div>
</div>
</section><section id="daten-von-einem-webserver-laden" class="level3"><h3 class="anchored" data-anchor-id="daten-von-einem-webserver-laden">Daten von einem Webserver laden</h3>
<p>Die CSV-Datei muss nicht lokal auf dem eigenen Rechner vorliegen, sondern kann mit <code>read_csv</code> über das HTTP-Protkoll direkt von einem Webserver im Internet abgerufen werden. Dabei wird die URL anstelle des lokalen Dateinamens der Funktion übergeben. Der Code unten lädt die tagesaktuelle Version des Covid-19-Datensatzes, der auf den Servern von <a href="https://ourworldindata.org/">Our World in Data</a> gehostet wird:</p>
<div class="cell">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">covid</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span><span class="st">"https://covid.ourworldindata.org/data/owid-covid-data.csv"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 221029 Columns: 67
-- Column specification --------------------------------------------------------
Delimiter: ","
chr   (4): iso_code, continent, location, tests_units
dbl  (62): total_cases, new_cases, new_cases_smoothed, total_deaths, new_dea...
date  (1): date

i Use `spec()` to retrieve the full column specification for this data.
i Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
</div>
</section></section><section id="übungsaufgaben" class="level2 unnumbered"><h2 class="unnumbered anchored" data-anchor-id="übungsaufgaben">Übungsaufgaben</h2>
<ol type="1">
<li><p>Ladet den tagesaktuellen Datensatz für die Covid-Daten, lasst aber nur die Spalten <code>date</code>, <code>location</code> und <code>new_cases_smoothed_per_million</code> im Ergebnis!</p></li>
<li><p>Korrigiert alle falsch als <code>&lt;dbl&gt;</code> erkannten ID-Spalten im Campusbier-Verkaufsdatensatz direkt beim Laden der Daten und wandelt sich in <code>&lt;chr&gt;</code> um.</p></li>
</ol>


</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./case-campusbier.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Fall: Campusbier</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./explore-new-data-sets.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Datensätze erkunden</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>